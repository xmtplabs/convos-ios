{
  "scripts": {
    "setup": "CI=true Scripts/setup.sh && SIM_NAME=\"conductor-$CONDUCTOR_WORKSPACE_NAME\" && if ! xcrun simctl list devices | grep -q \"$SIM_NAME\"; then BASE=$(xcrun simctl list devices available -j | grep -o '\"name\" : \"[^\"]*\"' | sed 's/\"name\" : \"//;s/\"//' | grep -E '^iPhone (17|16|15)' | head -1) && if [ -z \"$BASE\" ]; then echo \"Error: No iPhone 15/16/17 simulator found\"; exit 1; fi && xcrun simctl clone \"$BASE\" \"$SIM_NAME\" && echo \"Created simulator: $SIM_NAME\"; else echo \"Simulator exists: $SIM_NAME\"; fi && SIM_ID=$(xcrun simctl list devices -j | python3 -c \"import json,sys; d=json.load(sys.stdin); print(next((dev['udid'] for rt in d['devices'].values() for dev in rt if dev['name']=='$SIM_NAME'), ''))\") && mkdir -p .claude && echo \"$SIM_ID\" > .claude/.simulator_id && echo \"Saved simulator ID to .claude/.simulator_id\"",
    "run": "SIM_NAME=\"conductor-$CONDUCTOR_WORKSPACE_NAME\" && xcodebuild build -project Convos.xcodeproj -scheme 'Convos (Dev)' -destination \"platform=iOS Simulator,name=$SIM_NAME\" -derivedDataPath .derivedData && xcrun simctl boot \"$SIM_NAME\" 2>/dev/null; APP_PATH=$(find .derivedData/Build/Products -name 'Convos.app' -type d | head -1) && xcrun simctl install \"$SIM_NAME\" \"$APP_PATH\" && xcrun simctl launch \"$SIM_NAME\" org.convos.ios-preview && open -a Simulator",
    "archive": "SIM_NAME=\"conductor-$CONDUCTOR_WORKSPACE_NAME\" && xcrun simctl delete \"$SIM_NAME\" 2>/dev/null && echo \"Deleted simulator: $SIM_NAME\"; rm -rf .derivedData && echo \"Cleaned .derivedData\""
  },
  "runScriptMode": "nonconcurrent"
}
